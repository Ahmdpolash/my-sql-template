generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  // id         String     @id @default(auto()) @map("_id") @db.ObjectId
  id         String     @id @default(uuid())
  name       String
  email      String     @unique
  password   String
  profilePic String?    @default("")
  isVerified Boolean    @default(false)
  isDeleted  Boolean    @default(false)
  role       UserRole   @default(USER)
  status     UserStatus @default(Active)

  provider        String          @default("local")
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  Otp             Otp[]
  loginActivities LoginActivity[]

  @@map("users")
}

model Otp {
  // id          String   @id @default(auto()) @map("_id") @db.ObjectId
  id String @id @default(uuid())

  otpCode     Int
  expiresAt   DateTime
  userId      String
  // userId      String   @db.ObjectId
  minAttempts Int      @default(0)
  maxAttempts Int      @default(4)
  isUsed      Boolean  @default(false)

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([expiresAt])
  @@map("otps")
}

model LoginActivity {
  // id            String          @id @default(uuid()) @map("_id") @db.ObjectId
  // userId        String          @db.ObjectId
  id String @id @default(uuid())

  userId        String
  user          User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  ipAddress     String?
  userAgent     String?
  deviceType    String?
  browser       String?
  os            String?
  platform      DevicePlatform?
  location      String?
  loginAt       DateTime        @default(now())
  isSuccessful  Boolean         @default(true)
  failureReason String?

  @@index([userId, loginAt])
  @@index([userId, isSuccessful])
  @@map("login_activities")
}

enum UserRole {
  USER
  ADMIN
  SUPER_ADMIN
}

enum UserStatus {
  Active
  Inactive
  Banned
}

enum DevicePlatform {
  WEB
  ANDROID
  IOS
  DESKTOP
}

/**
 * id     String @id @default(auto()) @map("_id") @db.ObjectId
 * userId String @db.ObjectId
 * model LoginActivity {
 * id     String @id @default(auto()) @map("_id") @db.ObjectId
 * userId String @db.ObjectId
 * user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
 * ipAddress  String?
 * userAgent  String?
 * deviceType String? // e.g., "Mobile", "Desktop", "Tablet"
 * browser    String? // e.g., "Chrome", "Safari", "Firefox"
 * os         String? // e.g., "Windows", "macOS", "Android", "iOS"
 * platform   DevicePlatform?
 * location   String? // City, Country (if available)
 * loginAt       DateTime @default(now())
 * isSuccessful  Boolean  @default(true)
 * failureReason String? // If login failed
 * @@index([userId, loginAt])
 * @@index([userId, isSuccessful])
 * @@map("login_activities")
 * }
 */
